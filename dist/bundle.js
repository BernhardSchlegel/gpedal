(function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var i=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(i,'a',i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=2)})([function(e,t){'use strict';t.d=function(e){return new Promise((t)=>setTimeout(t,e))},t.b=function(e){return new Promise(function(t,i){let a=new FileReader;a.onload=(i)=>{t(i.target.result)},a.onerror=(t)=>{i(t.target.error)},a.readAsText(e,'UTF-8')})},t.c=function(e){return new Promise(function(t){let i=!1,a=(n)=>{e.removeEventListener('characteristicvaluechanged',a),e.stopNotifications(),i||(i=!0,t(n.target.value))};e.addEventListener('characteristicvaluechanged',a),e.startNotifications()})},t.a=function(e){let t=e.getUTCMonth()+1;t=10>t?'0'+t:t;let i=e.getUTCDate();i=10>i?'0'+i:i;let a=e.getUTCHours();a=10>a?'0'+a:a;let n=e.getUTCMinutes();n=10>n?'0'+n:n;let r=e.getUTCSeconds();return r=10>r?'0'+r:r,e.getUTCFullYear()+'-'+t+'-'+i+'T'+a+':'+n+':'+r+'Z'}},function(e,t){'use strict';t.a=function(e){return new Promise(function(t,i){n.geocode({location:e},function(e,a){'OK'===a?t(e):i(new Error(a))})})},t.c=function(e,t){return new Promise(function(i,n){let r={location:e,radius:t,source:google.maps.StreetViewSource.OUTDOOR};a.getPanorama(r,(e,t)=>{t==google.maps.StreetViewStatus.OK?i(e):n(new Error(t))})})},t.b=function(e){return new Promise(function(t,a){i.getElevationAlongPath(e,(e,i)=>{i==google.maps.ElevationStatus.OK?t(e):a(new Error(i))})})};let i=new google.maps.ElevationService,a=new google.maps.StreetViewService,n=new google.maps.Geocoder},function(e,t,i){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var a=i(3);document.addEventListener('DOMContentLoaded',()=>{Object(a.a)()})},function(e,t,i){'use strict';t.a=function(){let e=new URL(window.location),t=new l.a(e.search);if(t.get('state')&&t.get('code')){let e=t.get('code');return localStorage.setItem('strava-oauth-code',e),void window.location.assign('/')}let i=window.location.protocol;if('https:'!==i){let e=window.location.host;window.location.assign('https://'+e+'/')}localStorage.getItem('strava-oauth-code')&&(document.getElementById('strava-btn-connect').style.display='none',document.getElementById('strava-btn-connected').style.display='block'),'undefined'!=typeof navigator&&'bluetooth'in navigator?(document.getElementById('btn-bluetooth-device').style.display='inline-block',document.getElementById('btn-bluetooth-device-warning').style.display='none'):(document.getElementById('btn-bluetooth-device').style.display='none',document.getElementById('btn-bluetooth-device-warning').style.display='block');let s=[['virtual',new o.f]],d=[],c=[],p=document.getElementById('gpx-file-upload'),g=document.getElementById('begin-session'),m=document.getElementById('btn-bluetooth-device-txt'),u=document.getElementById('strava-btn-connect'),h=document.getElementById('btn-bluetooth-device'),v=document.getElementById('power-meter'),y=document.getElementById('hr-meter'),f=document.getElementById('cadence-meter');u.onclick=(t)=>{t.preventDefault();let e=window.location.protocol,i=window.location.host;window.location.assign('https://www.strava.com/oauth/authorize?client_id=19775&response_type=code&redirect_uri='+(e+'//'+i+'/')+'&scope=write&state=strava')},h.onclick=(t)=>{if(t.preventDefault(),!h.classList.contains('disabled'))h.classList.add('disabled');else return;m.innerHTML='Connecting ...',async function(){let e=await navigator.bluetooth.requestDevice({filters:[{services:[6157]},{services:[6168]},{services:[6166]}]}),t=await e.gatt.connect(),i=await t.getPrimaryServices();for(let a of i){let i=parseInt(a.uuid.substring(0,8),16);if(6168===i){if(s.find((t)=>t[0]===e.id))continue;let i=await a.getCharacteristic(10851),n=new o.e,l=await Object(r.c)(i),d=n.getData(l);if('cumulative_crank_revolutions'in d){let n=new o.c(e,t,a,i);s.push([n.id,n]),c.push([n.id,n])}else{let n=new o.d(e,t,a,i);s.push([n.id,n])}}else if(6166===i){if(c.find((t)=>t[0]===e.id))continue;let i=await a.getCharacteristic(10843),n=new o.a(e,t,a,i);c.push([n.id,n])}else if(6157===i){if(d.find((t)=>t[0]===e.id))continue;let i=await a.getCharacteristic(10807),n=new o.b(e,t,a,i);d.push([n.id,n])}}v.options.length=0;for(let[t,i]of s){var a=document.createElement('option');a.innerHTML=i.name,a.setAttribute('value',i.id),i.id===e.id&&a.setAttribute('selected','true'),v.add(a)}y.options.length=0;for(let[t,i]of d){var a=document.createElement('option');a.innerHTML=i.name,a.setAttribute('value',i.id),i.id===e.id&&a.setAttribute('selected','true'),y.options.add(a)}if(0===y.options.length){var a=document.createElement('option');a.innerHTML='Disabled',a.setAttribute('value',''),y.options.add(a)}f.options.length=0;for(let[t,i]of c){var a=document.createElement('option');a.innerHTML=i.name,a.setAttribute('value',i.id),i.id===e.id&&a.setAttribute('selected','true'),f.options.add(a)}if(0===f.options.length){var a=document.createElement('option');a.innerHTML='Disabled',a.setAttribute('value',''),f.options.add(a)}h.classList.remove('disabled'),m.innerHTML='Connect'}().catch((e)=>{h.classList.remove('disabled'),m.innerHTML='Connect',console.log('Error: ',e)})},g.onclick=(t)=>{if(t.preventDefault(),p.value){if(!g.classList.contains('disabled'))g.classList.add('disabled');else return;(async function(){let e=document.getElementById('rider-weight').value;e||(e=220);let t=await Object(r.b)(p.files[0]),i=new n.a(t),o=await i.create(),l=v.value,g=s.find((e)=>e[0]===l)[1];g.listen();let m,u=y.value;u&&(m=d.find((e)=>e[0]===u)[1],m.listen());let h,S=f.value;S&&(h=c.find((e)=>e[0]===S)[1],h.listen()),a.a.transitionUI();let _=new a.a(o,e,g,m,h);await _.geocodeRoute(),_.updateUI(),await _.updatePosition(),_.showFinalizeUI()})().catch((e)=>{console.log('Error: ',e)})}else{let e=document.getElementById('messages');e.innerHTML='Please select a GPX file.',e.style.display='block'}}};var a=i(4),n=i(8),r=i(0),o=i(11),s=i(12),l=i.n(s)},function(e,t,i){'use strict';var a=i(1),n=i(0),r=i(5),o=i(6),s=i(7),l=i.n(s);t.a=class{constructor(e,t,i,a,n){this.powerMeter=i,this.heartMeter=a,this.cadenceMeter=n,this.riderWeight=parseInt(t),this.routeName='',this.history=[],this.powerSamples=[],this.points=e,this.ridingState={pointIdx:0,point:this.points[0],pointPct:0,lastSampleTime:new Date,location:this.points[0].location,elevation:this.points[0].elevation,average_grade:0,mapMode:'SV',watts:0,rpm:void 0,bpm:void 0,speed:0,distance:0,climb:0,elapsed:0},this.miniMap=new google.maps.Map(document.getElementById('tracker'),{center:this.ridingState.point.location,zoom:14,fullscreenControl:!1,zoomControl:!0,mapTypeId:google.maps.MapTypeId.TERRAIN});let r=this.points.map((e)=>{return{lat:e.location.lat(),lng:e.location.lng()}}),o=new google.maps.Polyline({path:r,geodesic:!0,strokeColor:'#0c7ac9',strokeOpacity:1,strokeWeight:2});o.setMap(this.miniMap),this.fullMap=new google.maps.Map(document.getElementById('map-view'),{center:this.ridingState.point.location,zoom:18,fullscreenControl:!1,zoomControl:!0,mapTypeId:google.maps.MapTypeId.TERRAIN});let s=new google.maps.Polyline({path:r,geodesic:!0,strokeColor:'#0c7ac9',strokeOpacity:1,strokeWeight:2});s.setMap(this.fullMap),this.fullMarker=new google.maps.Marker({position:this.ridingState.point.location,map:this.fullMap,icon:'/images/here.png'}),this.fullMarker.setMap(this.fullMap);let l=this.streetViewPanoramaInit(this.ridingState.point.location,this.ridingState.point.heading);this.miniMap.setStreetView(l),this.powerMeter.addListener('power',(e)=>this.collectPower(e)),this.heartMeter&&this.heartMeter.addListener('hr',(e)=>this.collectHR(e)),this.cadenceMeter&&this.cadenceMeter.addListener('cadence',(e)=>this.collectCadence(e))}async geocodeRoute(){let e=await Object(a.a)(this.points[0].location),t=['street_address','route','intersection','postal_code'];for(let i of e){let e='';if(0<i.types.length&&(e=i.types[0]),t.includes(e))continue;else{this.routeName=i.formatted_address;break}}}collectPower(e){this.powerSamples.push(e)}collectHR(e){this.ridingState.bpm=e}collectCadence(e){this.ridingState.rpm=e}streetViewPanoramaInit(e,t){let i=document.getElementById('street-view');i.innerHTML='';let a=new google.maps.StreetViewPanorama(i,{visible:!0,fullscreenControl:!1,clickToGo:!1,addressControl:!1,panControl:!1,zoomControl:!1,linksControl:!1,pov:{heading:t,pitch:0},position:e});return a.addListener('status_changed',()=>{a.setPov({heading:this.ridingState.point.heading,pitch:0})}),a}async updatePosition(){for(let e=0;;){this.powerSamples.length&&(this.ridingState.watts=this.powerSamples.reduce((e,t)=>e+t,0)/this.powerSamples.length,this.powerSamples.length=0);let t=new Date,i=(t-this.ridingState.lastSampleTime)/1e3;this.ridingState.lastSampleTime=t;let r=1,o=0,s=0;for(;0<r;){let e=this.speedFromPower(this.ridingState.watts,this.ridingState.point.smoothedGrade,this.ridingState.point.elevation),t=this.ridingState.speed+0.2*(e-this.ridingState.speed);0.447>t&&(t=0);let a=t*i*r,n=this.ridingState.point.distance-this.ridingState.point.distance*this.ridingState.pointPct;if(a>n){let e=n/a;if(s+=this.ridingState.point.smoothedGrade*e,r-=r*e,this.ridingState.pointIdx+=1,this.ridingState.pointPct=0,this.ridingState.climb+=this.ridingState.point.climb,this.ridingState.point=this.points[this.ridingState.pointIdx],o+=n,this.ridingState.pointIdx>=this.points.length)break}else{let e=r;s+=this.ridingState.point.smoothedGrade*e,r=0,0==n?this.ridingState.pointPct=0:(this.ridingState.pointPct=1-(n-a)/this.ridingState.point.distance,o+=a)}}if(this.ridingState.pointIdx>=this.points.length)break;if(this.ridingState.average_grade=s,this.ridingState.distance+=o,this.ridingState.elevation=this.ridingState.point.elevation+this.ridingState.point.opposite*this.ridingState.pointPct,this.ridingState.speed=o/i,0<this.ridingState.speed&&(this.ridingState.elapsed+=i),this.ridingState.location=google.maps.geometry.spherical.interpolate(this.ridingState.point.location,this.points[this.ridingState.pointIdx+1].location,this.ridingState.pointPct),this.history.push({time:t,location:this.ridingState.location,power:this.ridingState.watts,elevation:this.ridingState.elevation,hr:this.ridingState.bpm,cad:this.ridingState.rpm}),0==e%5){let e=this.miniMap.getStreetView();try{let t=await Object(a.c)(this.ridingState.location,50);'MV'===this.ridingState.mapMode&&(document.getElementById('map-view').style.display='none',document.getElementById('tracker').style.display='block',document.getElementById('street-view').style.display='block',e.setVisible(!0),google.maps.event.trigger(e,'resize'),google.maps.event.trigger(this.miniMap,'resize')),this.miniMap.panTo(this.ridingState.location),e.setPano(t.location.pano),this.ridingState.mapMode='SV'}catch(t){'SV'===this.ridingState.mapMode&&(e.setVisible(!1),document.getElementById('street-view').style.display='none',document.getElementById('tracker').style.display='none',document.getElementById('map-view').style.display='block',google.maps.event.trigger(this.fullMap,'resize')),this.ridingState.mapMode='MV',this.fullMap.panTo(this.ridingState.location),this.fullMarker.setPosition(this.ridingState.location)}}e+=1,await Object(n.d)(1e3)}}speedFromPower(e,t,i){let a=1e3*Math.exp(-i/7e3),n={units:'metric',rp_wr:0.453592*this.riderWeight,rp_wb:8,rp_a:0.65,rp_cd:0.63,rp_dtl:4,ep_crr:5e-3,ep_g:t,ep_rho:Object(r.a)(23.8889,a,7.5)},s=Object(o.a)(e,n);return s*=0.277778,s}async updateUI(){for(var e=Math.floor;;){let t=this.ridingState.elapsed.toFixed(),i=e(t/3600),a=e((t-3600*i)/60),r=t-3600*i-60*a;10>a&&(a='0'+a),10>r&&(r='0'+r);let o=0===i?a+':'+r:i+':'+a+':'+r;let s=6.21371e-4*this.ridingState.distance;s=100<s?s.toFixed():s.toFixed(1);let l=this.ridingState.average_grade.toFixed(1);('-0'===l||'-0.0'===l)&&(l='0.0');let d=document.getElementById('grade-unit-icon');0<=l?d.classList.contains('fa-long-arrow-down')&&(d.classList.remove('fa-long-arrow-down'),d.classList.add('fa-long-arrow-up')):d.classList.contains('fa-long-arrow-up')&&(d.classList.remove('fa-long-arrow-up'),d.classList.add('fa-long-arrow-down'));let c=this.ridingState.watts;c=void 0!==c&&null!==c?c.toFixed():'--';let p=this.ridingState.bpm;p=void 0!==p&&null!==p?p.toFixed():'--';let g=this.ridingState.rpm;g=void 0!==g&&null!==g?g.toFixed():'--',document.getElementById('watts').innerHTML=c,document.getElementById('heart').innerHTML=p,document.getElementById('cadence').innerHTML=g,document.getElementById('speed').innerHTML=(2.23694*this.ridingState.speed).toFixed(),document.getElementById('distance').innerHTML=s,document.getElementById('climb').innerHTML=(3.28084*this.ridingState.climb).toFixed(),document.getElementById('time').innerHTML=o,document.getElementById('grade').innerHTML=l,await Object(n.d)(1e3)}}async stravaExport(){let e=document.getElementById('btn-export-strava');if(!e.classList.contains('disabled'))e.classList.add('disabled');else return;e.innerHTML='Exporting';let t=document.getElementById('input-ride-name'),i=t.value,a=document.getElementById('strava-gpx-template').innerHTML,r=this.history.map((e)=>{return{lat:e.location.lat(),lng:e.location.lng(),elevation:e.elevation.toFixed(5),time:Object(n.a)(e.time),power:e.power,hr:e.hr,cad:e.cad}}),o=l.a.render(a,{export_time:Object(n.a)(new Date),export_name:i,points:r}),s=new FormData;s.set('client_id','19775'),s.set('client_secret','d1fd34e8c88fc5611ff41d9361e0668e9fe676f0'),s.set('code',localStorage.getItem('strava-oauth-code'));let d=await fetch('https://www.strava.com/oauth/token',{method:'POST',body:s}),c=await d.json(),p=c.access_token,g=new File([o],'import_to_strava.gpx',{type:'text/xml'}),m=new FormData;m.set('activity_type','virtualride'),m.set('name',i),m.set('data_type','gpx'),m.set('file',g);let u=new Headers;u.set('Authorization','Bearer '+p);let h=await fetch('https://www.strava.com/api/v3/uploads',{method:'POST',headers:u,body:m}),v=await h.json(),y=v.id;for(;;){let e=await fetch('https://www.strava.com/api/v3/uploads/'+y,{headers:u}),t=await e.json();if(t.activity_id)break;await Object(n.d)(4e3)}e.innerHTML='Done!'}showFinalizeUI(){if(document.getElementById('ui-finalize-container').style.display='block',localStorage.getItem('strava-oauth-code')){let e=new Date,t='GPedal - ';t+=this.routeName?this.routeName:e.getMonth()+1+'/'+e.getDate();let i=document.getElementById('input-ride-name');i.value=t,i.style.display='block';let a=document.getElementById('btn-export-strava');a.style.display='block',a.onclick=(t)=>{t.preventDefault(),this.stravaExport().catch((e)=>{console.log('Error: ',e)})}}}static transitionUI(){document.getElementById('configure-container').style.display='none',document.getElementById('app-container').style.display='block'}}},function(e,t){'use strict';t.a=function(e,t,i){var a=6.1078/Math.pow(0.99999683+i*(-0.0090826951+i*(7.8736169e-5+i*(-6.1117958e-7+i*(4.3884187e-9+i*(-2.9883885e-11+i*(2.1874425e-13+i*(-1.7892321e-15+i*(1.1112018e-17+i*-3.0994571e-20)))))))),8),n=100*a;return(100*t-n)/(287.0531*(e+273.15))+n/(461.4964*(e+273.15))}},function(e,t){'use strict';function i(e,t){var i=Math.atan,a=9.8067*(t.rp_wr+t.rp_wb)*Math.sin(i(t.ep_g/100)),n=9.8067*(t.rp_wr+t.rp_wb)*Math.cos(i(t.ep_g/100))*t.ep_crr,r=0.5*t.rp_a*t.rp_cd*t.ep_rho*(1e3*e/3600)*(1e3*e/3600),o={};return o.Fgravity=a,o.Frolling=n,o.Fdrag=r,o}function a(e,t){var a=i(e,t),n=a.Fgravity+a.Frolling+a.Fdrag,r=n*(1e3*e/3600)/(1-t.rp_dtl/100);return r}t.a=function(e,t){var i=-1e3,n=1e3,r=0,o=a(r,t),s=0;do{if(Math.abs(o-e)<1e-6)break;o>e?n=r:i=r,r=(n+i)/2,o=a(r,t)}while(100>s++);return r}},function(e,t){var i,a,n;(function(r,o){'object'==typeof t&&t&&'string'!=typeof t.nodeName?o(t):(a=[t],i=o,n='function'==typeof i?i.apply(t,a):i,!(n!==void 0&&(e.exports=n)))})(this,function(e){function t(e){return'function'==typeof e}function i(e){return u(e)?'array':typeof e}function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,'\\$&')}function n(e,t){return null!=e&&'object'==typeof e&&t in e}function r(e,t){return h.call(e,t)}function o(e){return!r(v,e)}function s(t,n){function r(){if(k&&!I)for(;y.length;)delete v[y.pop()];else y=[];k=!1,I=!1}function s(e){if('string'==typeof e&&(e=e.split(S,2)),!u(e)||2!==e.length)throw new Error('Invalid tags: '+e);p=new RegExp(a(e[0])+'\\s*'),g=new RegExp('\\s*'+a(e[1])),m=new RegExp('\\s*'+a('}'+e[1]))}if(!t)return[];var p,g,m,h=[],v=[],y=[],k=!1,I=!1;s(n||e.tags);for(var E,x,T,M,C,L,B=new c(t);!B.eos();){if(E=B.pos,T=B.scanUntil(p),T)for(var P=0,i=T.length;P<i;++P)M=T.charAt(P),o(M)?y.push(v.length):I=!0,v.push(['text',M,E,E+1]),E+=1,'\n'===M&&r();if(!B.scan(p))break;if(k=!0,x=B.scan(w)||'name',B.scan(f),'='===x?(T=B.scanUntil(_),B.scan(_),B.scanUntil(g)):'{'===x?(T=B.scanUntil(m),B.scan(b),B.scanUntil(g),x='&'):T=B.scanUntil(g),!B.scan(g))throw new Error('Unclosed tag at '+B.pos);if(C=[x,T,E,B.pos],v.push(C),'#'===x||'^'===x)h.push(C);else if('/'===x){if(L=h.pop(),!L)throw new Error('Unopened section "'+T+'" at '+E);if(L[1]!==T)throw new Error('Unclosed section "'+L[1]+'" at '+E)}else'name'===x||'{'===x||'&'===x?I=!0:'='===x&&s(T)}if(L=h.pop(),L)throw new Error('Unclosed section "'+L[1]+'" at '+B.pos);return d(l(v))}function l(e){for(var t,a,n=[],r=0,i=e.length;r<i;++r)t=e[r],t&&('text'===t[0]&&a&&'text'===a[0]?(a[1]+=t[1],a[3]=t[3]):(n.push(t),a=t));return n}function d(e){for(var t,a,n=[],r=n,o=[],s=0,i=e.length;s<i;++s)switch(t=e[s],t[0]){case'#':case'^':r.push(t),o.push(t),r=t[4]=[];break;case'/':a=o.pop(),a[5]=t[2],r=0<o.length?o[o.length-1][4]:n;break;default:r.push(t);}return n}function c(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function g(){this.cache={}}var m=Object.prototype.toString,u=Array.isArray||function(e){return'[object Array]'===m.call(e)},h=RegExp.prototype.test,v=/\S/,y={"&":'&amp;',"<":'&lt;',">":'&gt;','"':'&quot;',"'":'&#39;',"/":'&#x2F;',"`":'&#x60;',"=":'&#x3D;'},f=/\s*/,S=/\s+/,_=/\s*=/,b=/\s*\}/,w=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){return''===this.tail},c.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return'';var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},c.prototype.scanUntil=function(e){var t,i=this.tail.search(e);return-1===i?(t=this.tail,this.tail=''):0===i?t='':(t=this.tail.substring(0,i),this.tail=this.tail.substring(i)),this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var i,a=this.cache;if(a.hasOwnProperty(e))i=a[e];else{for(var r,o,s=this,l=!1;s;){if(0<e.indexOf('.'))for(i=s.view,r=e.split('.'),o=0;null!=i&&o<r.length;)o===r.length-1&&(l=n(i,r[o])),i=i[r[o++]];else i=s.view[e],l=n(s.view,e);if(l)break;s=s.parent}a[e]=i}return t(i)&&(i=i.call(this.view)),i},g.prototype.clearCache=function(){this.cache={}},g.prototype.parse=function(e,t){var i=this.cache,a=i[e];return null==a&&(a=i[e]=s(e,t)),a},g.prototype.render=function(e,t,i){var a=this.parse(e),n=t instanceof p?t:new p(t);return this.renderTokens(a,n,i,e)},g.prototype.renderTokens=function(e,t,a,n){for(var r,o,s,l='',d=0,i=e.length;d<i;++d)s=void 0,r=e[d],o=r[0],'#'===o?s=this.renderSection(r,t,a,n):'^'===o?s=this.renderInverted(r,t,a,n):'>'===o?s=this.renderPartial(r,t,a,n):'&'===o?s=this.unescapedValue(r,t):'name'===o?s=this.escapedValue(r,t):'text'===o&&(s=this.rawValue(r)),void 0!==s&&(l+=s);return l},g.prototype.renderSection=function(e,i,a,n){function r(e){return o.render(e,i,a)}var o=this,s='',l=i.lookup(e[1]);if(l){if(u(l))for(var d=0,c=l.length;d<c;++d)s+=this.renderTokens(e[4],i.push(l[d]),a,n);else if('object'==typeof l||'string'==typeof l||'number'==typeof l)s+=this.renderTokens(e[4],i.push(l),a,n);else if(t(l)){if('string'!=typeof n)throw new Error('Cannot use higher-order sections without the original template');l=l.call(i.view,n.slice(e[3],e[5]),r),null!=l&&(s+=l)}else s+=this.renderTokens(e[4],i,a,n);return s}},g.prototype.renderInverted=function(e,t,i,a){var n=t.lookup(e[1]);if(!n||u(n)&&0===n.length)return this.renderTokens(e[4],t,i,a)},g.prototype.renderPartial=function(e,i,a){if(a){var n=t(a)?a(e[1]):a[e[1]];if(null!=n)return this.renderTokens(this.parse(n),i,a,n)}},g.prototype.unescapedValue=function(e,t){var i=t.lookup(e[1]);if(null!=i)return i},g.prototype.escapedValue=function(t,i){var a=i.lookup(t[1]);if(null!=a)return e.escape(a)},g.prototype.rawValue=function(e){return e[1]},e.name='mustache.js',e.version='2.3.0',e.tags=['{{','}}'];var k=new g;return e.clearCache=function(){return k.clearCache()},e.parse=function(e,t){return k.parse(e,t)},e.render=function(e,t,a){if('string'!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+i(e)+'" was given as the first argument for mustache#render(template, view, partials)');return k.render(e,t,a)},e.to_html=function(i,a,n,r){var o=e.render(i,a,n);return t(r)?void r(o):o},e.escape=function(e){return(e+'').replace(/[&<>"'`=\/]/g,function(e){return y[e]})},e.Scanner=c,e.Context=p,e.Writer=g,e})},function(e,t,i){'use strict';var a=i(9),n=i(0),r=i(1),o=i(10),s=i.n(o);class l{constructor({elevation:e,grade:t,smoothedGrade:i,distance:a,heading:n,climb:r,opposite:o,location:s}){this.elevation=e,this.grade=t,this.smoothedGrade=i,this.distance=a,this.heading=n,this.climb=r,this.opposite=o,this.location=s instanceof google.maps.LatLng?s:new google.maps.LatLng(s.lat,s.lng)}toJSON(){let{elevation:e,grade:t,smoothedGrade:i,distance:a,heading:n,climb:r,opposite:o}=this,s=this.location.toJSON();return{elevation:e,grade:t,smoothedGrade:i,distance:a,heading:n,climb:r,opposite:o,location:s}}static fromJSON(e){return new l(e)}}t.a=class{constructor(e){this.fileBody=e,this.md5=s()(e),this.points=[]}expandPointsWithGradeAndHeading(){for(let e,t=0;t<this.points.length;t++)if(e=this.points[t],t<this.points.length-1){let i=this.points[t+1];e.heading=google.maps.geometry.spherical.computeHeading(e.location,i.location);let a=google.maps.geometry.spherical.computeDistanceBetween(e.location,i.location),n=i.elevation-e.elevation;e.distance=a,e.grade=100*(n/a),e.opposite=n,e.climb=n}else e.distance=0,e.heading=0,e.grade=0,e.opposite=0,e.climb=0;let e=this.points.map((e,t)=>{return[t,e.grade]}),t=a.a.smooth.kernel2().kernel('Gaussian').data(e).scale(2);t();let i=t.output();for(let e=0;e<this.points.length;e++)this.points[e].smoothedGrade=i[e][1],(0.95>this.points[e].smoothedGrade||0>this.points[e].climb)&&(this.points[e].climb=0)}async expandPointsWithElevation(e){let t=0,i=20,a=512;for(;t<e.length;){0<t&&(await Object(n.d)(4e3));let o=[],s=0,d=0;for(let n=t;n<e.length;n++){let t=e[n],r=0;if(n<e.length-1){let i=e[n+1];r=google.maps.geometry.spherical.computeDistanceBetween(t.location,i.location)}if(s+=r,d+=1,s<=a*i&&d<a)o.push(t.location);else{d-=1,s-=r;break}}let c={path:o,samples:Math.ceil(s/i)},p=await Object(r.b)(c),g=p.map((t)=>{return new l({elevation:t.elevation,location:t.location})});Array.prototype.push.apply(this.points,g),t=d+t}}async create(){if(localStorage.getItem(this.md5)){let e=JSON.parse(localStorage.getItem(this.md5));this.points=e.map((e)=>{return l.fromJSON(e)})}else{let e=new DOMParser,t=e.parseFromString(this.fileBody,'text/xml'),i=Array.from(t.documentElement.getElementsByTagName('trkpt')).map((e)=>{let t=parseFloat(e.getAttribute('lat')),i=parseFloat(e.getAttribute('lon'));return new l({location:{lat:t,lng:i}})});await this.expandPointsWithElevation(i),this.expandPointsWithGradeAndHeading(),localStorage.setItem(this.md5,JSON.stringify(this.points))}return this.points}}},function(e,t){'use strict';function a(e,t,a){return 1/Math.sqrt(2*i)*h(-(u(e-t,2)/(2*u(a,2))))}function n(e,t,i){return 1<m((e-t)/i)?0:3/4*(1-u((e-t)/i,2))}function r(e,t,i){return 1/(h((e-t)/i)+h(-(e-t)/i))}function o(e,t,i){return 1<m((e-t)/i)?0:1/2}function s(e,t,i){return 1<m((e-t)/i)?0:1-m((e-t)/i)}function l(e,t,i){return 1<m((e-t)/i)?0:15/16*u(1-u((e-t)/i,2),2)}function d(e,t,i){return 1<m((e-t)/i)?0:35/32*u(1-u((e-t)/i,2),3)}function c(e,t,a){return 1<m((e-t)/a)?0:i/4*Math.cos(i/2*((e-t)/a))}function p(e,t,i){return 1<m((e-t)/i)?0:70/81*u(1-u(m((e-t)/i),3),3)}function g(e,t,a){var n=Math.SQRT2,r=m((t-e)/a);return 0.5*h(-r/n)*Math.sin(r/n+i/4)}var i=Math.PI,m=Math.abs,u=Math.pow,h=Math.exp;const v={};t.a=v,v.smooth={},v.smooth.kernel2=function(){function e(){var e=[];e=y.map(function(e){return[S(e),_(e)]});var a=[];if('number'==typeof v)for(t=0;t<e.length;t++)a.push(v);else if(!('object'==typeof v&&Array.isArray(v)))throw console.log(v),new Error('Invalid scale parameter');else if(v.length===e.length)a=v.slice();else{var n=0;for(t=0;t<e.length;t++)a.push(v[n]),t<v.length?n++:n=0}for(t=0;t<e.length;t++){var r=0,o=0,s=0,l=u[f](e[t][0],e[t][0],a[t]);for(r+=l*e[t][1],o+=l,i=t-1;-1<i&&(s=u[f](e[t][0],e[i][0],a[t]),!(s/l<h));i--)r+=s*e[i][1],o+=s;for(i=t+1;i<e.length&&(s=u[f](e[t][0],e[i][0],a[t]),!(s/l<h));i++)r+=s*e[i][1],o+=s;m.push([e[t][0],r/o])}}var t,i,m=[],u={Uniform:o,Triangle:s,Epanechnikov:n,Quartic:l,Triweight:d,Logistic:r,Cosine:c,Gaussian:a,Tricube:p,Silverman:g},h=1e-3,v=[],y=[],f='Gaussian',S=function(e){return e[0]},_=function(e){return e[1]};return e.scale=function(t){return arguments.length?(v=t,e):v},e.kernel=function(t){if(!arguments.length)return f;if('function'!=typeof u[t])throw new Error('Invalid kernel');return f=t,e},e.x=function(t){return arguments.length?(S=t,e):S},e.y=function(t){return arguments.length?(_=t,e):_},e.output=function(){return m},e.diff=function(t){return arguments.length?(h=t,e):h},e.data=function(t){return y=t,e},e}},function(e,t,i){var a;(function(n){'use strict';function r(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function o(e,t){return e<<t|e>>>32-t}function l(e,i,a,n,l,s){return r(o(r(r(i,e),r(n,s)),l),a)}function s(e,i,a,n,r,o,s){return l(i&a|~i&n,e,i,r,o,s)}function p(e,i,a,n,r,o,s){return l(i&n|a&~n,e,i,r,o,s)}function g(e,i,a,n,r,o,s){return l(i^a^n,e,i,r,o,s)}function m(e,i,a,n,r,o,s){return l(a^(i|~n),e,i,r,o,s)}function d(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n,i,o,l,u,h=1732584193,a=-271733879,v=-1732584194,c=271733878;for(n=0;n<e.length;n+=16)i=h,o=a,l=v,u=c,h=s(h,a,v,c,e[n],7,-680876936),c=s(c,h,a,v,e[n+1],12,-389564586),v=s(v,c,h,a,e[n+2],17,606105819),a=s(a,v,c,h,e[n+3],22,-1044525330),h=s(h,a,v,c,e[n+4],7,-176418897),c=s(c,h,a,v,e[n+5],12,1200080426),v=s(v,c,h,a,e[n+6],17,-1473231341),a=s(a,v,c,h,e[n+7],22,-45705983),h=s(h,a,v,c,e[n+8],7,1770035416),c=s(c,h,a,v,e[n+9],12,-1958414417),v=s(v,c,h,a,e[n+10],17,-42063),a=s(a,v,c,h,e[n+11],22,-1990404162),h=s(h,a,v,c,e[n+12],7,1804603682),c=s(c,h,a,v,e[n+13],12,-40341101),v=s(v,c,h,a,e[n+14],17,-1502002290),a=s(a,v,c,h,e[n+15],22,1236535329),h=p(h,a,v,c,e[n+1],5,-165796510),c=p(c,h,a,v,e[n+6],9,-1069501632),v=p(v,c,h,a,e[n+11],14,643717713),a=p(a,v,c,h,e[n],20,-373897302),h=p(h,a,v,c,e[n+5],5,-701558691),c=p(c,h,a,v,e[n+10],9,38016083),v=p(v,c,h,a,e[n+15],14,-660478335),a=p(a,v,c,h,e[n+4],20,-405537848),h=p(h,a,v,c,e[n+9],5,568446438),c=p(c,h,a,v,e[n+14],9,-1019803690),v=p(v,c,h,a,e[n+3],14,-187363961),a=p(a,v,c,h,e[n+8],20,1163531501),h=p(h,a,v,c,e[n+13],5,-1444681467),c=p(c,h,a,v,e[n+2],9,-51403784),v=p(v,c,h,a,e[n+7],14,1735328473),a=p(a,v,c,h,e[n+12],20,-1926607734),h=g(h,a,v,c,e[n+5],4,-378558),c=g(c,h,a,v,e[n+8],11,-2022574463),v=g(v,c,h,a,e[n+11],16,1839030562),a=g(a,v,c,h,e[n+14],23,-35309556),h=g(h,a,v,c,e[n+1],4,-1530992060),c=g(c,h,a,v,e[n+4],11,1272893353),v=g(v,c,h,a,e[n+7],16,-155497632),a=g(a,v,c,h,e[n+10],23,-1094730640),h=g(h,a,v,c,e[n+13],4,681279174),c=g(c,h,a,v,e[n],11,-358537222),v=g(v,c,h,a,e[n+3],16,-722521979),a=g(a,v,c,h,e[n+6],23,76029189),h=g(h,a,v,c,e[n+9],4,-640364487),c=g(c,h,a,v,e[n+12],11,-421815835),v=g(v,c,h,a,e[n+15],16,530742520),a=g(a,v,c,h,e[n+2],23,-995338651),h=m(h,a,v,c,e[n],6,-198630844),c=m(c,h,a,v,e[n+7],10,1126891415),v=m(v,c,h,a,e[n+14],15,-1416354905),a=m(a,v,c,h,e[n+5],21,-57434055),h=m(h,a,v,c,e[n+12],6,1700485571),c=m(c,h,a,v,e[n+3],10,-1894986606),v=m(v,c,h,a,e[n+10],15,-1051523),a=m(a,v,c,h,e[n+1],21,-2054922799),h=m(h,a,v,c,e[n+8],6,1873313359),c=m(c,h,a,v,e[n+15],10,-30611744),v=m(v,c,h,a,e[n+6],15,-1560198380),a=m(a,v,c,h,e[n+13],21,1309151649),h=m(h,a,v,c,e[n+4],6,-145523070),c=m(c,h,a,v,e[n+11],10,-1120210379),v=m(v,c,h,a,e[n+2],15,718787259),a=m(a,v,c,h,e[n+9],21,-343485551),h=r(h,i),a=r(a,o),v=r(v,l),c=r(c,u);return[h,a,v,c]}function c(e){var t,i='',a=32*e.length;for(t=0;t<a;t+=8)i+=String.fromCharCode(255&e[t>>5]>>>t%32);return i}function u(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var a=8*e.length;for(t=0;t<a;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function h(e){return c(d(u(e),8*e.length))}function v(e,t){var a,i,n=u(e),r=[],o=[];for(r[15]=o[15]=void 0,16<n.length&&(n=d(n,8*e.length)),a=0;16>a;a+=1)r[a]=909522486^n[a],o[a]=1549556828^n[a];return i=d(r.concat(u(t)),512+8*t.length),c(d(o.concat(i),640))}function y(e){var t,a,i='0123456789abcdef',n='';for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),n+=i.charAt(15&t>>>4)+i.charAt(15&t);return n}function f(e){return unescape(encodeURIComponent(e))}function S(e){return h(f(e))}function _(e){return y(S(e))}function b(e,t){return v(f(e),f(t))}function w(e,t){return y(b(e,t))}function k(e,t,i){return t?i?b(t,e):w(t,e):i?S(e):_(e)}a=function(){return k}.call(t,i,t,e),!(a!==void 0&&(e.exports=a))})(this)},function(e,t){'use strict';let i=['getInt16',2,!0],a=['getUint16',2,!0],n=['getUint32',4,!0],r=[[0,[[i,'instantaneous_power']]],[1,[[['getUint8',1],'pedal_power_balance']]],[2,[]],[4,[[a,'accumulated_torque']]],[8,[]],[16,[[n,'cumulative_wheel_revolutions'],[a,'last_wheel_event_time']]],[32,[[a,'cumulative_crank_revolutions'],[a,'last_crank_event_time']]],[64,[[i,'maximum_force_magnitude'],[i,'minimum_force_magnitude']]],[128,[[i,'maximum_torque_magnitude'],[i,'minimum_torque_magnitude']]],[256,[[['getUint8',3],'maximum_minimum_angle']]],[512,[[a,'top_dead_spot_angle']]],[1024,[[a,'bottom_dead_spot_angle']]],[2048,[[a,'accumulated_energy']]],[4096,[]]],o=[[1,[[n,'cumulative_wheel_revolutions'],[a,'last_wheel_event_time']]],[2,[[a,'cumulative_crank_revolutions'],[a,'last_crank_event_time']]]];class s{getData(e){let t,i=0;16===this.mask_size?(t=e.getUint16(0,!0),i+=2):(t=e.getUint8(0),i+=1);let a=[];if(0===this.fields[0][0])for(let e of this.fields[0][1])a.push(e);for(let[i,n]of this.fields)if(t&i)for(let e of n)a.push(e);let n={};for(let t of a){var[[o,s,l],r]=t;let a;a=l?e[o](i,l):e[o](i),n[r]=a,i+=s}return n}}class l extends s{constructor(){super(),this.fields=o,this.mask_size=8}}class d extends s{constructor(){super(),this.fields=r,this.mask_size=16}}t.e=d;class c{constructor(e,t,i,a){this.device=e,this.server=t,this.service=i,this.characteristic=a,this.name=this.device.name,this.id=this.device.id,this.listening=!1,this.listeners={},this.device.addEventListener('gattserverdisconnected',(t)=>{this.gattserverdisconnected(t).catch((e)=>{console.log('Error: ',e)})})}async gattserverdisconnected(){console.log('Reconnecting'),this.server=await this.device.gatt.connect(),this.service=await this.server.getPrimaryService(this.serviceId),this.characteristic=await this.service.getCharacteristic(this.characteristicId),this.listening&&(this.listening=!1,this.listen())}addListener(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}dispatch(e,t){e in this.listeners||(this.listeners[e]=[]);for(let i of this.listeners[e])i(t)}}t.c=class extends c{constructor(e,t,i,a){super(e,t,i,a),this.serviceId=6168,this.characteristicId=10851,this.parser=new d,this.lastCrankRevolutions=0,this.lastCrankTime=0}listen(){this.listening||(this.characteristic.addEventListener('characteristicvaluechanged',(e)=>{let t=this.parser.getData(e.target.value),i=t.instantaneous_power,a=t.cumulative_crank_revolutions,n=t.last_crank_event_time;this.lastCrankTime>n&&(this.lastCrankTime-=65536),this.lastCrankRevolutions>a&&(this.lastCrankRevolutions-=65536);let r=a-this.lastCrankRevolutions,o=(n-this.lastCrankTime)/1024,s=0;0<o&&(s=60*(r/o)),this.lastCrankRevolutions=a,this.lastCrankTime=n,this.dispatch('power',i),this.dispatch('cadence',s)}),this.characteristic.startNotifications(),this.listening=!0)}};t.d=class extends c{constructor(e,t,i,a){super(e,t,i,a),this.serviceId=6168,this.characteristicId=10851,this.parser=new d}listen(){this.listening||(this.characteristic.addEventListener('characteristicvaluechanged',(e)=>{let t=this.parser.getData(e.target.value),i=t.instantaneous_power;this.dispatch('power',i)}),this.characteristic.startNotifications(),this.listening=!0)}};t.a=class extends c{constructor(e,t,i,a){super(e,t,i,a),this.serviceId=6166,this.characteristicId=10843,this.parser=new l,this.lastCrankRevolutions=0,this.lastCrankTime=0}listen(){this.listening||(this.characteristic.addEventListener('characteristicvaluechanged',(e)=>{let t=this.parser.getData(e.target.value),i=t.cumulative_crank_revolutions,a=t.last_crank_event_time;if(i!==void 0&&a!==void 0){this.lastCrankTime>a&&(this.lastCrankTime-=65536),this.lastCrankRevolutions>i&&(this.lastCrankRevolutions-=65536);let e=i-this.lastCrankRevolutions,t=(a-this.lastCrankTime)/1024,n=0;0<t&&(n=60*(e/t)),this.lastCrankRevolutions=i,this.lastCrankTime=a,this.dispatch('cadence',n)}}),this.characteristic.startNotifications(),this.listening=!0)}};t.b=class extends c{constructor(e,t,i,a){super(e,t,i,a),this.serviceId=6157,this.characteristicId=10807}listen(){this.listening||(this.characteristic.addEventListener('characteristicvaluechanged',(e)=>{let t=e.target.value.getUint8(1);this.dispatch('hr',t)}),this.characteristic.startNotifications(),this.listening=!0)}};t.f=class{constructor(){this.listeners={},this.listening=!1,this.watts=0,this.id='virtual',this.name='Virtual Power Meter'}listen(){if(!this.listening){document.getElementById('ui-vpower-container').style.display='block';let e=document.getElementById('vpower');e.value=this.watts,e.onchange=()=>{this.watts=parseInt(e.value)},setInterval(()=>{this.dispatch('power',this.watts)},750),this.listening=!0}}addListener(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}dispatch(e,t){e in this.listeners||(this.listeners[e]=[]);for(let i of this.listeners[e])i(t)}}},function(e,t,i){'use strict';(function(t){function i(e){var t,r,s,l,d,i,c=Object.create(null);if(this[g]=c,!!e)if('string'==typeof e)for('?'===e.charAt(0)&&(e=e.slice(1)),l=e.split('&'),d=0,i=l.length;d<i;d++)s=l[d],t=s.indexOf('='),-1<t?a(c,n(s.slice(0,t)),n(s.slice(t+1))):s.length&&a(c,n(s),'');else if(o(e))for(d=0,i=e.length;d<i;d++)s=e[d],a(c,s[0],s[1]);else for(r in e)a(c,r,e[r])}function a(e,t,i){t in e?e[t].push(''+i):e[t]=o(i)?i:[''+i]}function n(e){return decodeURIComponent(e.replace(d,' '))}function r(e){return encodeURIComponent(e).replace(l,p)}var o=Array.isArray,s=i.prototype,l=/[!'\(\)~]|%20|%00/g,d=/\+/g,c={"!":'%21',"'":'%27',"(":'%28',")":'%29',"~":'%7E',"%20":'+',"%00":'\0'},p=function(e){return c[e]},g='__URLSearchParams__:'+Math.random();s.append=function(e,t){a(this[g],e,t)},s.delete=function(e){delete this[g][e]},s.get=function(e){var t=this[g];return e in t?t[e][0]:null},s.getAll=function(e){var t=this[g];return e in t?t[e].slice(0):[]},s.has=function(e){return e in this[g]},s.set=function(e,t){this[g][e]=[''+t]},s.forEach=function(e,t){var i=this[g];Object.getOwnPropertyNames(i).forEach(function(a){i[a].forEach(function(i){e.call(t,i,a,this)},this)},this)},s.toJSON=function(){return{}},s.toString=function(){var e,t,i,a,n=this[g],o=[];for(t in n)for(i=r(t),e=0,a=n[t];e<a.length;e++)o.push(i+'='+r(a[e]));return o.join('&')},i=e.exports=t.URLSearchParams||i,function(e){var t=function(){try{return!!Symbol.iterator}catch(e){return!1}}();'forEach'in e||(e.forEach=function(e,t){var i=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,'=').split('=').forEach(function(a){!a.length||a in i||(i[a]=this.getAll(a)).forEach(function(i){e.call(t,i,a,this)},this)},this)}),'keys'in e||(e.keys=function(){var e=[];this.forEach(function(t,i){e.push(i)});var i={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t&&(i[Symbol.iterator]=function(){return i}),i}),'values'in e||(e.values=function(){var e=[];this.forEach(function(t){e.push(t)});var i={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t&&(i[Symbol.iterator]=function(){return i}),i}),'entries'in e||(e.entries=function(){var e=[];this.forEach(function(t,i){e.push([i,t])});var i={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t&&(i[Symbol.iterator]=function(){return i}),i}),t&&!(Symbol.iterator in e)&&(e[Symbol.iterator]=e.entries),'sort'in e||(e.sort=function(){for(var e,t,i,a=this.entries(),n=a.next(),r=n.done,o=[],s=Object.create(null);!r;)i=n.value,t=i[0],o.push(t),t in s||(s[t]=[]),s[t].push(i[1]),n=a.next(),r=n.done;for(o.sort(),e=0;e<o.length;e++)this.delete(o[e]);for(e=0;e<o.length;e++)t=o[e],this.append(t,s[t].shift())})}(i.prototype)}).call(t,i(13))},function(e){var t=function(){return this}();try{t=t||Function('return this')()||(1,eval)('this')}catch(i){'object'==typeof window&&(t=window)}e.exports=t}]);
//# sourceMappingURL=bundle.js.map